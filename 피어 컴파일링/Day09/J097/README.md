## 피어 컴파일

### 실행하기 전에

`main.mjs` 에서 테스트를 설정할 수 있습니다.

```javascript
let testCondition = [
  ["비선점 기한부 스케줄링", POLICY.DEADLINE, false],
  ["비선점 고정 우선순위 스케줄링", POLICY.SPRIORITY, false],
  ["선점 라운드 로빈 스케줄링", POLICY.RROBIN, true]
]
```

테스트 조건입니다. 각 요소는 앞에서부터 `테스트 이름`, `사용할 정책`, `선점 여부` 입니다.

예를 들어 첫 요소의 테스트 이름은 비선점 기한부 스케줄링이고, 기한부 정책을 사용하며, 비선점으로 동작합니다.

만약 첫 요소의 false를 true 로 변경한다면 선점 기한부 스케줄링을 시뮬레이트 합니다.

```javascript
let testCondition = [
  ["비선점 기한부 스케줄링", POLICY.DEADLINE, false],
  ["비선점 고정 우선순위 스케줄링", POLICY.SPRIORITY, false],
  ["비선점 라운드 로빈 스케줄링", POLICY.RROBIN, false],
  ["선점 기한부 스케줄링", POLICY.DEADLINE, true],
  ["선점 고정 우선순위 스케줄링", POLICY.SPRIORITY, true],
  ["선점 라운드 로빈 스케줄링", POLICY.RROBIN, true],
]
```

만약 원한다면 위와 같이 설정하여 모든 정책의 선점, 비선점 테스트를 할 수 있습니다.

또한, 스케줄러의 생성자에는 5가지의 인자가 있습니다.

```javascript
  let scheduler = new Scheduler(test[1], test[2], true, 500, 100);
```

앞의 두 인자는 앞서 언급한 사용할 정책과 선점 여부이며, 그 뒤로는 `쓰레드 사용 여부`, `스케줄러의 한 스텝당 걸리는 실제 시간(ms)`, `스레드가 동작을 수행하는데 걸리는 실제 시간(ms)` 입니다.

`쓰레드 사용 여부`를 false로 맞추면 미션 1의 테스트, true로 맞추면 미션 2의 테스트를 할 수 있습니다.

스케쥴러 시뮬레이터 실행에 시간이 소모되는 것이 싫다면 `null` 을 기입하시면 됩니다.

### 실행

```bash
node main.mjs
```

### 테스트 결과보는 법

![image](https://user-images.githubusercontent.com/57206558/181581698-3325d702-4581-4943-9c94-dadc02d21a71.png)

스레드의 실제 종료 시간은 종료 요청 시간과 꽤 차이가 있고, 메인 스레드에서 동기하여 확인하는 것이 아니라 이벤트 방식으로 종료를 감지하므로 종료됨 메세지가 종료 요청 직후에 나오지 않는 것은 정상적인 출력입니다. 

### 파일 구조

- main.mjs : 시뮬레이터를 실행하는 메인
- pq.mjs : 우선순위 큐 모듈
- scheduler.mjs : 프로세스 스케줄러 클래스
- process.mjs : 프로세스 클래스
- thread.mjs : 프로세스에서 생성된 쓰레드가 실행하는 파일

### 출력 이미지

![image](https://user-images.githubusercontent.com/57206558/181646303-c29ff1c4-5f1e-4fbc-a4d1-3f661285b726.png)

## 체크리스트

### 프로세스 스케줄링 시각화

- OS에서 프로세스 실행부터 종료까지의 작업을 시뮬레이션
- 프로세스 스케줄링 시각화 구현으로 방식별 비교

기능 요구사항

- 마치 운영체제가 프로세스를 스케줄링하는 것처럼 프로세스를 일정한 시간동안 실행하는 프로그램을 구현한다.

- 프로세스 종류를 A부터 F까지 6개 정하고, 프로세스 마다 최대 동작 시간을 겹치지 않도록 결정한다.

  예) 프로세스A : 3초, 프로세스B : 5초, 프로세스C : 7초, 프로세스D : 10초, 프로세스E : 15초, 프로세스F : 21초

- 우리가 목표로 하는 운영체제는 한 번에 프로세스 하나씩만 1초동안만 실행할 수 있다. 해당 프로세스 외 다른 프로세스는 실행하지 않는다.

- 1초 이후에는 같은 프로세스가 아니라 다른 프로세스를 실행해야 한다. 만약 프로세스가 1개만 남은 경우 반복해서 같은 프로세스를 실행할 수 있다.

- 프로세스 상태는 준비ready, 실행running, 대기waiting, 종료terminated 4 가지 상태 중에 하나다.

사전 목표 (2번 미션에서 끌어올림)

- [x] 우선순위 큐 구현

프로그래밍 요구 사항

- [x] 랜덤으로 프로세스 3개를 생성하고 대기 큐에 추가
  - [x] 프로세스 (ready, waiting) 에서만 running 으로 바뀔 수 있음
  - [x] 누적 동작 시간 >= 최대 동작 시간인 경우 terminated 로 바뀜
  - [x] 누적 동작 시간 \< 최대 동작 시간인 경우 waiting 상태로
- [x] 프로세스마다 (작업 정보)를 포함하는 (데이터 구조 or 타입) 선언
  - [x] 실제로 프로세스가 어떤 작업을 하도록 구현해라
- [x] 프로그램은 1초마다 전체 프로세스의 (상태, 대기 시간, 누적 실행 시간) 표시
- [x] 프로그램은 모든 프로세스가 (terminated) 가 되면 종료
- [x] 프로그램에서 구현해야 하는 스케줄링
  - [x] 기한부 스케줄링
  - [x] 고정 우선순위 스케줄링
  - [x] 라운드 로빈 스케줄링

### 스레드 스케줄링

- 프로세스-스레드의 차이점을 이해하고, 스레드로 병렬 처리를 할 수 있도록 구현
- 프로세스, 스레드 스케줄링 방식과 알고리즘에 대해 이해하고 우선순위 큐 방식 구현

기능 요구사항

- 이전 단계 요구사항을 만족한 상태로 스레드가 추가되는 방식으로 구현해야 한다.

- 각 프로세스는 스레드를 만들 수 있고, 스레드가 있으면 스레드마다 실행 시간을 2초 단축하는 효과가 있다고 가정한다.

- 프로그램을 시작할 때 프로세스 별로 최대 작업 시간을 2로 나눴을 때 몫만큼 스레드를 생성한다.

  예) 프로세스 3초 -> 스레드 1개 , 프로세스 6초 -> 스레드 3개

- 프로그램이 시작하면 랜덤으로 프로세스 3개를 생성하고, 스레드 개수도 표시한다.

- 프로그램은 모든 프로세스 작업이 끝나면 종료한다.

프로그래밍 요구사항

- [x] 각자 언어와 환경에서 스레드를 생성하고 각 스레드는 1초 후에 동작을 완료한다.
  - Node.js : worker 모듈
- [x] 특정 프로세스는 할당된 모든 스레드가 동작을 완료해야 해당 프로세스는 동작을 멈춘다.
  - 예를 들어 프로세스 B가 5초 작업이라 스레드 2개를 생성해야 한다면, 한 번 실행할 때 1초 동안 2개 스레드가 모두 완료해야 다음 프로세스로 스케줄링이 넘어간다.

## 학습 메모

### 비선점 스케줄링에서도 무조건 context switch를 해야 하는가?

1초 이후에는 무조건 실행중인 프로세스를 바꾸라는 항목이 있다. 실행하다가 블락되는 경우를 고려하는 것도 아니고 이런 요구 사항이 있는 것이 이해되지 않는다.

라운드 로빈을 제외하고는 비선점으로 동작하도록 구현하였다.

### 프로세스 간의 

### 기한부 스케줄링이 무엇인가?

아무리 찾아봐도 '기한부 스케줄링' 에 대해서는 기한 안에 하는 것을 목표로 한다고만 되어있고 이를 어떻게 관리하는 지에 대한 레퍼런스는 웹에서 찾을 수가 없었다.

그나마 비슷한 개념이라면 Earliest Deadline First 라는 알고리즘이 있었다.

그 뒤로는 deadline 이 지난 job은 어떻게 할 것인가? 에 대한 의문도 남았다. 이 역시 문제에서도 아무런 설명도 없고, 웹에서 찾아봤을 때는 마감이 지난 job은 의미가 없다는 내용들이 많았다.

따라서 나는 본 문제에서의 기한부 스케줄링을 다음과 같이 할당한다.

1. 주어진 시간을 다 때려넣어도 데드라인 넘기는 것들은 터미네이트
2. 데드라인이 가장 가까운 것을 우선 실행

- [x] 고정 우선순위 스케줄링이 무엇인가?
- [x] 라운드 로빈 스케줄링이 무엇인가?
- [x] worker 모듈은 어떻게 동작하는가?

- [x] 자바 스크립트에서는 정수 나눗셈 어떻게?
[[JS] 정수 나눗셈 - 몫 구하기](https://velog.io/@skyepodium/JS-%EC%A0%95%EC%88%98-%EB%82%98%EB%88%97%EC%85%88-%EB%AA%AB-%EA%B5%AC%ED%95%98%EA%B8%B0)

학습거리

- [ ] 폰 노이만 구조
- [ ] 하버드 구조
- [ ] 프로세스나 스레드가 만들어지고 종료될 때까지 스케줄러에 의해 상태가 어떻게 변화하는지 학습
- [x] Node.js 환경의 웹 워커, 워커 스레드 학습

## 개선점

- [x] 비동기나 이벤트 방식에 익숙하지 않아서 효율적인 대기를 못 하고 있다

  예를 들어 프로세스가 스레드를 만들 때 순차적으로 만들어질 까지 기다리는 것. 프로세스 스레드를 먼저 다 만들고 다 만들어질 때까지 기다리는 방식, promise.all? 이라는 방식이 있는 것 같은데 그런걸로 했으면 더 효율적이었을텐데 하는 생각도 들음.

  개선함

- [x] workerData 활용

  스레드 러닝 타임을 전달함